{% extends "home_base.html" %}
{% load wagtailcore_tags %}
{% load staticfiles %}
{% load filters %}
{% load top_entities elections_lookup home_page commissioners %}
{% block body_class %}template-{{ self.get_verbose_name | slugify }}{% endblock %}

{% block content %}
  <section class="hero hero--home" aria-labelledby="hero-heading">
    <div class="container">
      <div class="hero__content">
        <h2 id="hero-heading">Protecting the integrity of the campaign finance process</h2>
        <a class="button button--thin-border" href="/about">More about the FEC</a>
      </div>
    </div>
  </section>

  {% home_page_banner_announcement %}
  
  <section class="slab">
    {% comment %} 
    Below is for featured icon+links in Wagtail html block only...for now. 
    {% endcomment %}
    {% for block in self.body %}
      {% if block.block_type == "html" %}
        <div class="container">
         {{ block.value }}
        </div>
      {% endif %}
    {% endfor %}
    <div class="container">
      <div class="heading--section heading--with-action">
        <h2 class="heading__left">News and announcements</h2>
        <a class="button--cta button--updates heading__right" href="/updates">All news</a>
      </div>

      {% home_page_news %}

      <div class="heading--section heading--with-action">
        <h2 class="heading__left">Events and deadlines</h2>
        <a class="button--cta heading__right button--calendar" href="/calendar">Full calendar</a>
      </div>
      <div class="grid grid--4-wide grid--flex t-sans">
        <div class="grid__item grid__item--with-button">
          <div class="t-bold">Next open commission meeting:</div>
          <div class="js-next-commission-meeting"></div>
          <a class="button button--alt button--updates" href="/meetings">All meetings</a>
        </div>
        <div class="grid__item grid__item--with-button">
          <div class="t-sans t-bold">Next filing deadline:</div>
          <div class="js-next-filing-deadline"></div>
          <a class="button button--alt button--calendar" href="/calendar/?calendar_category_id=25&calendar_category_id=26&calendar_category_id=27">All filing deadlines</a>
        </div>
        <div class="grid__item grid__item--with-button">
          <div class="t-sans t-bold">Next training or conference:</div>
          <div class="js-next-training-or-conference"></div>
          <a class="button button--alt button--calendar" href="/calendar/?calendar_category_id=33&calendar_category_id=34">All outreach</a>
        </div>
        <div class="grid__item grid__item--with-button">
          <div class="t-sans t-bold">Next public comment deadline:</div>
          <div class="js-next-public-comment-deadline"></div>
          <a class="button button--alt button--calendar" href="/calendar/?calendar_category_id=23">All legal events</a>
        </div>
      </div>
    </div>
  </section>

  <section class="slab slab--home slab--neutral">
    <div class="container">

    {% elections_lookup request %}

      <div class="grid grid--3-wide grid--no-border slab--spacious-margin slab--ruled u-padding--top">
        <div class="grid__item">
          <div class="icon-heading icon-heading--direction-sign-circle primary">
            <p class="t-sans t-small icon-heading__text"><a href="/introduction-campaign-finance/understanding-ways-support-federal-candidates/">Understand ways to support federal candidates</a></p>
          </div>
        </div>
        <div class="grid__item">
          <div class="icon-heading icon-heading--financial-document primary">
            <p class="t-sans t-small icon-heading__text"><a href="/introduction-campaign-finance/how-to-research-public-records/">Learn more about using the FEC's campaign finance data</a></p>
          </div>
        </div>
        <div class="grid__item">
          <div class="icon-heading icon-heading--election-circle primary">
            <p class="t-sans t-small icon-heading__text"><a href="/introduction-campaign-finance/election-and-voting-information/">Find election results and voting information</a></p>
          </div>
        </div>
      </div>

    {% raising_spending request %}

    </div>
  </section>
  <section class="slab">
    <div class="container">
      <h1>Commissioners</h1>
      {% current_commissioners '3' %}
    </div>
  </section>
{% endblock %}

{% block extra_js %}
<script>
  var canSkipPolyfills = ('fetch' in window && 'assign' in Object);
  if (!canSkipPolyfills) {
    var pfScriptElem = document.createElement('script');
    pfScriptElem.async = false;
    pfScriptElem.src = "{% asset_for_js 'polyfills.js' %}";
    document.head.appendChild(pfScriptElem);
  }

</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script defer src="{% asset_for_js 'home.js' %}" type="text/javascript" charset="utf-8"></script>
<script defer async src="{% asset_for_js 'bythenumbers.js' %}" type="text/javascript" charset="utf-8"></script>

<script defer>
  // var byTheNumbersScriptElem = document.createElement('script');
  // byTheNumbersScriptElem.async = true;
  // byTheNumbersScriptElem.defer = true;
  // byTheNumbersScriptElem.src = "{% asset_for_js 'bythenumbers.js' %}";
  // document.body.appendChild(byTheNumbersScriptElem);

  var lazyLoadImages = document.querySelectorAll('img.lazyload');
  for (var i=0; i < lazyLoadImages.length; i++) {
    var elem = lazyLoadImages[i];
    elem.setAttribute('src', elem.getAttribute('data-src'));
  }

  // var lazyLoadScripts = document.querySelectorAll('script[data-src]');
  // for (var i=0; i < lazyLoadScripts.length; i++) {
  //   console.log('for()');
  //   var elem = lazyLoadScripts[i];
  //   var newElem = document.createElement('script');
  //   for (var j = 0; j < elem.attributes.length; j++) {
  //     var thisAttr = elem.attributes[j];
  //     // console.log('  elem.attributes: ', elem.attributes);
  //     // console.log('  elem.attributes[',j,']: ', elem.attributes[j]);
  //     newElem.setAttribute(thisAttr.name, thisAttr.value);
  //   }
  //   newElem.setAttribute('src', elem.getAttribute('data-src'));
  //   console.log('parentelem: ', elem.parentElement);
  //   console.log('newElem: ', newElem);
  //   elem.parentElement.appendChild(newElem);
    // elem.setAttribute('src', elem.getAttribute('data-src'));
  // }
</script>

<!-- <script defer async src="{% asset_for_js 'home.js' %}"></script> -->
<!-- <script defer async src="{% asset_for_js 'bythenumbers.js' %}"></script> -->

<!-- <script src="{% asset_for_js 'dataviz-common.js' %}"></script> -->
<!-- <script src="{% asset_for_js 'election-lookup.js' %}"></script> -->
<script>
  //remove competing/confusing querystrings on homepage
  $(function(){
    cleanURI()
    function cleanURI(){
      const uri = window.location.toString();
      if (uri.indexOf('?') > 0) {
        window.history.replaceState({}, document.title, location.href.split('?')[0]);
      }
    }
    $('#main').on('change ', 'input, select', function(){
      cleanURI();
    })
    //handle Chrome insconsistency with History API
    $('.js-office').val('P');
    $('.js-election-year').val('2020')
    $('.js-chart-toggle').filter('[value=receipts]').prop('checked', true)
  });
</script>
{% endblock %}
